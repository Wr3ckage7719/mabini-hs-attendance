/* ========================================
   STUDENT MOBILE ENHANCEMENTS
   Mobile responsive styles for student portal
   Target: 360-430px (primary), 480px, 768px, 1024px
   ======================================== */

/* Ensure proper viewport handling */
html, body {
    overflow-x: hidden !important;
    width: 100% !important;
    max-width: 100% !important;
}

/* Mobile-specific box sizing */
@media (max-width: 767px) {
    * {
        box-sizing: border-box !important;
    }
}

/* ========================================
   HEADER - MOBILE LAYOUT (Max 430px)
   ======================================== */
@media (max-width: 430px) {
    .portal-header {
        padding: 12px 16px !important;
        min-height: 64px !important;
    }
    
    .portal-header-content {
        display: flex !important;
        align-items: center !important;
        justify-content: space-between !important;
        width: 100% !important;
    }
    
    /* Logo - compact */
    .portal-logo {
        font-size: 14px !important;
    }
    
    .portal-logo svg {
        width: 24px !important;
        height: 24px !important;
    }
    
    .portal-logo .logo-text {
        font-size: 14px !important;
        margin-left: 0.25rem !important;
    }
    
    /* Portal actions - horizontal layout */
    .portal-actions {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 4px !important;
        flex-wrap: nowrap !important;
    }
    
    /* Theme toggle - compact */
    .theme-toggle-wrap {
        margin-right: 0 !important;
    }
    
    .toggle-switch .switch-track {
        width: 40px !important;
        height: 22px !important;
    }
    
    .toggle-switch .switch-thumb {
        width: 18px !important;
        height: 18px !important;
    }
    
    .theme-icons {
        display: none !important;
    }
    
    /* Notifications button */
    #notificationsBtn {
        min-width: 44px !important;
        min-height: 44px !important;
        padding: 10px !important;
        margin-right: 0 !important;
    }
    
    #notificationsBtn svg {
        width: 20px !important;
        height: 20px !important;
    }
    
    /* Settings dropdown */
    .portal-settings {
        position: relative !important;
        margin-right: 0 !important;
    }
    
    #settingsToggle {
        min-width: 44px !important;
        min-height: 44px !important;
        padding: 10px !important;
        font-size: 14px !important;
    }
    
    #settingsMenu {
        right: 0 !important;
        top: 48px !important;
        min-width: 200px !important;
        z-index: 1000 !important;
    }
}

/* ========================================
   PROFILE SIDEBAR - MOBILE (Max 767px)
   ======================================== */
@media (max-width: 767px) {
    .portal-container {
        display: flex !important;
        flex-direction: column !important;
        padding: 0 !important;
        gap: 0 !important;
    }
    
    .profile-sidebar {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        padding: 16px 12px !important;
        position: relative !important;
    }
    
    .profile-card {
        padding: 20px 16px !important;
        border-radius: 12px !important;
        margin-bottom: 16px !important;
    }
    
    /* Profile photo */
    .profile-photo-wrap img,
    #profilePhoto {
        width: 100px !important;
        height: 100px !important;
    }
    
    /* Profile info - compact */
    .profile-info h2,
    .profile-card h2 {
        font-size: 20px !important;
        margin-bottom: 4px !important;
    }
    
    .student-id,
    .profile-card p {
        font-size: 13px !important;
    }
    
    /* QR code */
    .qr-code-wrap {
        margin: 16px 0 !important;
    }
    
    #qrCodeCanvas {
        width: 140px !important;
        height: 140px !important;
    }
    
    /* Status badge */
    .status-badge {
        font-size: 13px !important;
        padding: 6px 12px !important;
    }
    
    /* Profile details grid */
    .profile-details {
        display: grid !important;
        grid-template-columns: 1fr !important;
        gap: 12px !important;
        margin-top: 16px !important;
    }
    
    .detail-item {
        padding: 12px !important;
        border-radius: 8px !important;
    }
    
    .detail-item strong {
        font-size: 12px !important;
        margin-bottom: 4px !important;
    }
    
    .detail-item span {
        font-size: 14px !important;
    }
}

/* ========================================
   MAIN CONTENT AREA (Max 767px)
   ======================================== */
@media (max-width: 767px) {
    .content-main {
        width: 100% !important;
        max-width: 100% !important;
        padding: 0 12px 16px 12px !important;
        margin: 0 !important;
    }
    
    /* Main card - ensure content fits */
    .main-card {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 0 16px 0 !important;
        padding: 16px 12px !important;
        border-radius: 12px !important;
        box-sizing: border-box !important;
        overflow: hidden !important;
    }
    
    /* Stats grid inside main cards */
    .main-card > div {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
    }
    
    /* Force all grids in main cards to single column */
    .main-card div[style] {
        max-width: 100% !important;
    }
    
    /* Responsive text sizing in main cards */
    .main-card h3 {
        font-size: 16px !important;
    }
    
    .main-card h2 {
        font-size: 18px !important;
    }
    
    /* Attendance index section */
    .attendance-index,
    .attendance-history-section {
        width: 100% !important;
        padding: 16px 12px !important;
        box-sizing: border-box !important;
    }
    
    .attendance-title {
        font-size: 18px !important;
        margin-bottom: 12px !important;
    }
    
    /* Attendance search form - stack vertically on mobile */
    .attendance-search-form {
        display: flex !important;
        flex-direction: column !important;
        gap: 12px !important;
        width: 100% !important;
    }
    
    .attendance-search-input,
    .attendance-year-select,
    .attendance-search-btn {
        width: 100% !important;
        min-height: 44px !important;
        font-size: 16px !important;
        box-sizing: border-box !important;
    }
    
    .attendance-search-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
        border: none !important;
        border-radius: 8px !important;
        font-weight: 600 !important;
        padding: 12px !important;
    }
    
    /* Cards */
    .info-card,
    .attendance-card,
    .card {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 0 16px 0 !important;
        padding: 16px 12px !important;
        border-radius: 12px !important;
        box-sizing: border-box !important;
    }
    
    .card-header {
        padding: 12px !important;
        font-size: 16px !important;
    }
    
    .card-title {
        font-size: 16px !important;
        margin-bottom: 8px !important;
    }
    
    .card-body {
        padding: 12px !important;
    }
    
    /* Stats grid */
    .stats-grid {
        display: grid !important;
        grid-template-columns: 1fr !important;
        gap: 12px !important;
        margin-bottom: 16px !important;
    }
    
    .stat-card {
        padding: 16px !important;
        border-radius: 10px !important;
        width: 100% !important;
    }
    
    .stat-label {
        font-size: 12px !important;
    }
    
    .stat-value {
        font-size: 24px !important;
    }
    
    /* Performance Insights Cards - Force single column on mobile */
    .main-card div[style*="display: grid"][style*="grid-template-columns"] {
        display: grid !important;
        grid-template-columns: 1fr !important;
        gap: 12px !important;
    }
    
    /* Performance card items */
    .main-card div[style*="display: grid"] > div {
        width: 100% !important;
        max-width: 100% !important;
        min-height: auto !important;
        padding: 16px !important;
    }
    
    /* Make stat numbers more readable on mobile */
    .main-card div[style*="display: grid"] > div span[id*="Rate"],
    .main-card div[style*="display: grid"] > div span[id*="Streak"],
    .main-card div[style*="display: grid"] > div span[id*="Needed"] {
        font-size: 2rem !important;
    }
    
    /* Ensure text doesn't overflow */
    .main-card div[style*="display: grid"] > div div[style*="text-transform: uppercase"] {
        font-size: 0.7rem !important;
        white-space: normal !important;
        overflow: visible !important;
        text-overflow: clip !important;
    }
}

/* ========================================
   TABLES - MOBILE RESPONSIVE (Max 767px)
   ======================================== */
@media (max-width: 767px) {
    .table-responsive {
        display: block !important;
        width: 100% !important;
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
        margin: 0 !important;
        padding: 0 !important;
        border-radius: 8px !important;
        box-sizing: border-box !important;
    }
    
    .table-responsive table,
    .table {
        width: 100% !important;
        max-width: 100% !important;
        margin-bottom: 0 !important;
        font-size: 13px !important;
        box-sizing: border-box !important;
    }
    
    .table thead th {
        padding: 10px 8px !important;
        font-size: 12px !important;
        white-space: nowrap !important;
    }
    
    .table tbody td {
        padding: 10px 8px !important;
        font-size: 13px !important;
        white-space: nowrap !important;
    }
    
    /* First column sticky */
    .table thead th:first-child,
    .table tbody td:first-child {
        position: sticky !important;
        left: 0 !important;
        background: var(--card-bg, #ffffff) !important;
        z-index: 5 !important;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1) !important;
    }
    
    [data-theme="dark"] .table thead th:first-child,
    [data-theme="dark"] .table tbody td:first-child {
        background: var(--card-bg, #1a1d20) !important;
    }
}

/* ========================================
   BUTTONS - MOBILE (Max 767px)
   ======================================== */
@media (max-width: 767px) {
    .btn,
    button:not(.portal-btn):not(#settingsToggle):not(#notificationsBtn) {
        min-height: 44px !important;
        font-size: 15px !important;
        padding: 10px 16px !important;
        border-radius: 8px !important;
    }
    
    .btn-primary,
    .btn-success,
    .btn-danger {
        width: 100% !important;
        margin-bottom: 8px !important;
    }
    
    .btn-group {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 8px !important;
    }
    
    .btn-group .btn {
        flex: 1 1 auto !important;
        min-width: calc(50% - 4px) !important;
    }
    
    /* Attendance Overview Card - Stack on mobile */
    .main-card > div[style*="display: grid"][style*="grid-template-columns: 1fr 2fr"] {
        display: flex !important;
        flex-direction: column !important;
        gap: 1.5rem !important;
    }
    
    /* Main rate display - center on mobile */
    .main-card > div[style*="display: grid"] > div:first-child {
        text-align: center !important;
        margin: 0 auto !important;
    }
    
    /* Stats grid inside attendance overview */
    .main-card > div[style*="display: grid"] > div:last-child > div[style*="grid-template-columns: repeat(3, 1fr)"] {
        display: grid !important;
        grid-template-columns: 1fr !important;
        gap: 0.75rem !important;
    }
}

/* ========================================
   FORMS - MOBILE (Max 767px)
   ======================================== */
@media (max-width: 767px) {
    .form-control,
    .form-select,
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="date"],
    textarea,
    select {
        min-height: 44px !important;
        font-size: 16px !important; /* Prevents iOS zoom */
        padding: 10px 12px !important;
        width: 100% !important;
        box-sizing: border-box !important;
        border-radius: 8px !important;
    }
    
    textarea {
        min-height: 100px !important;
    }
    
    .form-group,
    .mb-3 {
        margin-bottom: 16px !important;
    }
    
    label {
        font-size: 14px !important;
        margin-bottom: 6px !important;
        display: block !important;
    }
}

/* ========================================
   NOTIFICATIONS MODAL (Max 767px)
   ======================================== */
@media (max-width: 767px) {
    #notificationModal,
    .modal {
        padding: 0 !important;
    }
    
    #notificationModal .modal-content,
    .modal-content {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        border-radius: 12px 12px 0 0 !important;
        max-height: 90vh !important;
    }
    
    .modal-header {
        padding: 16px !important;
        border-radius: 12px 12px 0 0 !important;
    }
    
    .modal-title {
        font-size: 18px !important;
    }
    
    .modal-body {
        padding: 12px !important;
        max-height: 70vh !important;
        overflow-y: auto !important;
    }
    
    .notification-item {
        padding: 12px !important;
        margin-bottom: 8px !important;
        border-radius: 8px !important;
    }
    
    .notification-item h6 {
        font-size: 14px !important;
    }
    
    .notification-item p {
        font-size: 13px !important;
    }
}

/* ========================================
   SPECIFIC FOR 360-430px DEVICES
   Maximum Specificity Override
   ======================================== */
@media (min-width: 360px) and (max-width: 430px) {
    /* Force containers to full width */
    .portal-container,
    .content-main,
    .profile-sidebar {
        width: 100% !important;
        max-width: 100% !important;
        padding-left: 12px !important;
        padding-right: 12px !important;
    }
    
    /* Force cards full width */
    .info-card,
    .attendance-card,
    .profile-card,
    .stat-card,
    .card {
        width: 100% !important;
        max-width: 100% !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
    
    /* Force tables responsive */
    .table-responsive {
        width: 100% !important;
        overflow-x: auto !important;
    }
    
    /* Force buttons full width */
    .btn-primary,
    .btn-success,
    .btn-danger,
    button[type="submit"] {
        width: 100% !important;
        max-width: 100% !important;
    }
}

/* ========================================
   TABLET ADJUSTMENTS (768px - 1023px)
   ======================================== */
@media (min-width: 768px) and (max-width: 1023px) {
    .portal-container {
        flex-direction: row !important;
        gap: 20px !important;
    }
    
    .profile-sidebar {
        width: 300px !important;
        min-width: 300px !important;
    }
    
    .content-main {
        flex: 1 !important;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr) !important;
    }
}

/* ========================================
   LANDSCAPE MOBILE (Max 767px height)
   ======================================== */
@media (max-width: 767px) and (orientation: landscape) {
    .profile-photo-wrap img,
    #profilePhoto {
        width: 80px !important;
        height: 80px !important;
    }
    
    #qrCodeCanvas {
        width: 120px !important;
        height: 120px !important;
    }
    
    .profile-card {
        padding: 16px 12px !important;
    }
}

/* ========================================
   TOUCH OPTIMIZATIONS
   ======================================== */
@media (hover: none) and (pointer: coarse) {
    /* Larger touch targets */
    .btn,
    .form-control,
    .form-select,
    a,
    button {
        min-height: 44px !important;
    }
    
    /* Remove hover states on touch devices */
    .btn:hover,
    .card:hover {
        transform: none !important;
    }
    
    /* Add active states instead */
    .btn:active {
        transform: scale(0.98) !important;
    }
    
    .card:active {
        transform: scale(0.99) !important;
    }
}

/* ========================================
   DARK MODE ADJUSTMENTS
   ======================================== */
[data-theme="dark"] {
    /* Ensure proper contrast on mobile */
    .profile-card,
    .info-card,
    .attendance-card,
    .stat-card,
    .card {
        background: var(--card-bg, #1a1d20) !important;
        border-color: var(--border-color, #374151) !important;
    }
    
    .table thead th:first-child,
    .table tbody td:first-child {
        background: var(--card-bg, #1a1d20) !important;
    }
}
