<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Dashboard</title>
    <meta name="theme-color" content="#4f46e5">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script>(function(){const t=localStorage.getItem('theme'),p=window.matchMedia('(prefers-color-scheme: dark)').matches,theme=t||(p?'dark':'light');document.documentElement.setAttribute('data-theme',theme);document.documentElement.setAttribute('data-bs-theme',theme);})();</script>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="css/student-mobile.css">
    <script src="../assets/js/theme.js" defer></script>
    <style>
        /* Settings menu: dynamic colors based on data-theme
           - light: black text on white background
           - dark: white text on dark card background (uses existing --card-bg)
        */
        html[data-theme='light'] .portal-settings #settingsMenu,
        html[data-theme='light'] .portal-settings #settingsMenu a,
        html[data-theme='light'] .portal-settings #settingsMenu strong,
        html[data-theme='light'] .portal-settings #settingsMenu span {
            color: #000 !important;
            background: #fff !important;
        }

        html[data-theme='dark'] .portal-settings #settingsMenu,
        html[data-theme='dark'] .portal-settings #settingsMenu a,
        html[data-theme='dark'] .portal-settings #settingsMenu strong,
        html[data-theme='dark'] .portal-settings #settingsMenu span {
            color: #fff !important;
            background: var(--card-bg) !important;
        }

        /* Make links and text inherit the menu color by default */
        .portal-settings #settingsMenu a,
        .portal-settings #settingsMenu strong,
        .portal-settings #settingsMenu span {
            color: inherit !important;
        }

        /* Logo color adapts to theme (uses currentColor for SVG/text) */
        html[data-theme='light'] .portal-logo {
            color: #000 !important;
        }
        html[data-theme='dark'] .portal-logo {
            color: #fff !important;
        }
        .portal-logo svg {
            fill: currentColor;
            display: inline-block;
            vertical-align: middle;
        }
        .portal-logo .logo-text {
            font-weight: 700;
            margin-left: 0.5rem;
            font-size: 1rem;
            line-height: 1;
        }
    </style>
</head>
<body class="portal-bg">
    <header class="portal-header">
        <div class="portal-header-content">
            <a href="#" class="portal-logo" aria-label="Student portal home" style="display:inline-flex; align-items:center; text-decoration:none; color:inherit;">
                <svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L1 7l11 5 9-4.09V17h2V7L12 2zM11 13.18L3 9.65v2.83l8 3.36 8-3.36V9.65l-8 3.53zM5 18v2h14v-2l-7 3-7-3z"/>
                </svg>
                <span class="logo-text">STUDENT</span>
            </a>
            <div class="portal-actions">
                <!-- Theme toggle: icon button -->
                <button id="themeToggle" class="portal-btn" style="background:none; border:none; cursor:pointer; padding:0.5rem; font-size:24px; line-height:1; color:inherit;" aria-label="Toggle theme">
                    <i class="bi bi-sun-fill sun-icon"></i>
                    <i class="bi bi-moon-fill moon-icon"></i>
                </button>
                <!-- Notifications Button -->
                <button id="notificationsBtn" class="portal-btn" style="position:relative; background:none; border:none; cursor:pointer; padding:0.5rem; font-size:24px; line-height:1; color:inherit;" aria-label="View notifications">
                    <i class="bi bi-bell-fill"></i>
                    <span id="notificationBadge" class="notification-badge" style="display:none; position:absolute; top:0.3rem; right:0.3rem; background:#ef4444; color:#fff; border-radius:50%; width:18px; height:18px; font-size:10px; font-weight:bold; display:flex; align-items:center; justify-content:center;"></span>
                </button>
                <!-- Settings Button -->
                <div class="portal-settings" id="settingsDropdown" style="position:relative;">
                    <button id="settingsToggle" class="portal-btn" style="background:none; border:none; cursor:pointer; padding:0.5rem; font-size:24px; line-height:1; color:inherit;" aria-label="Settings menu">
                        <i class="bi bi-gear-fill"></i>
                    </button>
                    <div id="settingsMenu" style="display:none; position:absolute; right:0; top:36px; background:var(--card-bg); border:1px solid var(--border-color); padding:0.5rem; border-radius:8px; min-width:180px; box-shadow:0 6px 18px rgba(0,0,0,0.2);">
                        <a href="settings.html" style="display:flex; align-items:center; gap:0.6rem; padding:0.6rem 0.6rem; color:inherit; text-decoration:none;">
                            <!-- settings (gear) icon -->
                            <svg viewBox="0 0 24 24" width="25" height="25" fill="currentColor" style="opacity:0.95;"><path d="M12 8.6A3.4 3.4 0 1 0 12 15.4 3.4 3.4 0 0 0 12 8.6zm8.1 2.1l1.8-1.1-1.6-2.8-2.1.4a7.9 7.9 0 0 0-1.2-.7l-.3-2.2H9.4l-.3 2.2c-.4.2-.8.4-1.2.7L5.6 6.8 4 9.6l1.8 1.1c-.1.3-.1.6-.1.9s0 .6.1.9L4 14.6l1.6 2.8 2.1-.4c.4.3.8.5 1.2.7l.3 2.2h4.6l.3-2.2c.4-.2.8-.4 1.2-.7l2.1.4L21.9 14l-1.8-1.3c.1-.3.1-.6.1-.9s0-.6-.1-.9z"/></svg>
                            <strong style="font-size:1rem;">Open Settings</strong>
                        </a>
                        <div style="display:flex; flex-direction:column; gap:0.25rem; padding:0.25rem 0;">
                            <a href="#" onclick="doLogout(); return false;" style="display:flex; align-items:center; gap:0.6rem; padding:0.45rem 0.6rem; color:inherit; text-decoration:none;">
                                <!-- logout icon -->
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" style="opacity:0.95;"><path d="M16 13v-2H7V8l-5 4 5 4v-3zM20 3h-8v2h8v14h-8v2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
                                <span>Log out</span>
                            </a>
                        </div>
                    </div>
                </div>
                    <!-- Log out button moved to Settings menu -->
            </div>
        </div>
    </header>
    <div class="portal-container">
        <aside class="profile-sidebar">
            <div class="profile-card" id="profileCard" style="opacity: 0; transition: opacity 0.3s ease;">
                <div class="profile-photo-wrap">
                    <img id="profilePhoto" src="" alt="Profile Photo" style="width:120px;height:120px;border-radius:50%;object-fit:cover;display:none;border:2px solid rgba(255,255,255,0.06);" />
                    <div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #4698e5 0%, #3a8eed 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; font-weight: bold;" id="profileInitials">...</div>
                </div>
                <div class="profile-name" id="studentName">Loading...</div>
                <div class="student-id" id="studentId">Student ID: ...</div>
                <div class="profile-qr">
                    <img src="img/QR.jpg" alt="QR Code" class="qr-img" style="opacity: 0.3;">
                </div>
                <div class="profile-status-toggle">
                    <span>Status:</span>
                    <span class="profile-status-label enrolled">Enrolled</span>
                </div>
                <div class="profile-info-list">
                    <div class="profile-info-item"><span>Student Number</span><span id="studentNumber">...</span></div>
                    <div class="profile-info-item"><span>Grade Level</span><span id="gradeLevel">...</span></div>
                    <div class="profile-info-item"><span>Section</span><span id="section">...</span></div>
                </div>

                <div class="profile-contact">
                    <div class="contact-title">Contact Information</div>
                    <div class="contact-detail"><strong>Email:</strong> <span id="contactEmail">loading...</span></div>
                    <div class="contact-detail"><strong>Phone:</strong> <span id="contactPhone">loading...</span></div>
                    <div class="contact-detail"><strong>Address:</strong> <span id="contactAddress">Not provided</span></div>
                </div>

                <div class="profile-personal">
                    <div class="personal-title">Personal Information</div>
                    <div class="personal-info-item"><span>Sex:</span> <span id="studentSex">Not specified</span></div>
                    <div class="personal-info-item"><span>Nationality:</span> <span id="studentNationality">Not specified</span></div>
                    <div class="personal-info-item"><span>Birth Date:</span> <span id="studentBirthDate">Not provided</span></div>
                    <div class="personal-info-item"><span>Birth Place:</span> <span id="studentBirthPlace">Not provided</span></div>
                </div>

                <div class="profile-personal" style="margin-top: 1rem;">
                    <div class="personal-title">Parent/Guardian Information</div>
                    <div class="personal-info-item"><span>Name:</span> <span id="parentGuardianName">Not provided</span></div>
                    <div class="personal-info-item"><span>Contact:</span> <span id="parentGuardianContact">Not provided</span></div>
                    <div class="personal-info-item"><span>Email:</span> <span id="parentGuardianEmail">Not provided</span></div>
                </div>
            </div>
        </aside>
        <main class="portal-main">
            <!-- Attendance Summary Card - Full Width -->
            <div class="main-card" style="padding: 2rem; margin-bottom: 1.5rem;">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); width: 56px; height: 56px; display: flex; align-items: center; justify-content: center; border-radius: 12px;">
                        <svg viewBox="0 0 24 24" width="28" height="28" fill="white">
                            <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                        </svg>
                    </div>
                    <div>
                        <h2 style="margin: 0; font-size: 1.5rem; font-weight: 700;">Attendance Overview</h2>
                        <p style="margin: 0.25rem 0 0 0; font-size: 0.875rem; opacity: 0.7;">Current School Year Performance Based on Scheduled Classes</p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; align-items: center;">
                    <!-- Main Rate Display -->
                    <div style="text-align: center;">
                        <div id="attendanceRateDisplay" style="font-size: 4.5rem; font-weight: 700; line-height: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">0%</div>
                        <div id="attendanceStatus" style="font-size: 1.125rem; font-weight: 600; margin-top: 0.75rem; color: #667eea;">Checking Status...</div>
                        <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(102, 126, 234, 0.05); border-radius: 8px;">
                            <div style="font-size: 0.875rem; opacity: 0.7; margin-bottom: 0.25rem;">Required Minimum</div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: #667eea;">75%</div>
                        </div>
                    </div>
                    
                    <!-- Progress and Stats -->
                    <div>
                        <!-- Progress Bar -->
                        <div style="margin-bottom: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                <span style="font-weight: 600; font-size: 0.95rem;" id="progressLabel">Progress to Goal</span>
                                <span style="font-size: 0.875rem; opacity: 0.7;">Target: 75%</span>
                            </div>
                            <div style="background: rgba(128, 128, 128, 0.1); height: 16px; border-radius: 999px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                                <div id="attendanceProgress" style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); height: 100%; width: 0%; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1), background 0.3s ease; border-radius: 999px; position: relative;">
                                    <div style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: white; font-size: 0.75rem; font-weight: 700;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stats Grid -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                            <div style="text-align: center; padding: 1.25rem; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.2);">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.7; margin-bottom: 0.5rem;">Attended</div>
                                <div id="summaryPresent" style="font-size: 2rem; font-weight: 700; color: #10b981;">0</div>
                                <div style="font-size: 0.75rem; margin-top: 0.25rem; opacity: 0.6;">Classes</div>
                            </div>
                            <div style="text-align: center; padding: 1.25rem; background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%); border-radius: 12px; border: 1px solid rgba(239, 68, 68, 0.2);">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.7; margin-bottom: 0.5rem;">Missed</div>
                                <div id="summaryAbsent" style="font-size: 2rem; font-weight: 700; color: #ef4444;">0</div>
                                <div style="font-size: 0.75rem; margin-top: 0.25rem; opacity: 0.6;">Classes</div>
                            </div>
                            <div style="text-align: center; padding: 1.25rem; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%); border-radius: 12px; border: 1px solid rgba(102, 126, 234, 0.2);">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.7; margin-bottom: 0.5rem;">Total</div>
                                <div id="summaryTotal" style="font-size: 2rem; font-weight: 700; color: #667eea;">0</div>
                                <div style="font-size: 0.75rem; margin-top: 0.25rem; opacity: 0.6;">Scheduled</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Warning Message -->
                <div id="attendanceWarning" style="display: none; margin-top: 1.5rem; padding: 1.25rem; background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%); border-left: 4px solid #ef4444; border-radius: 8px;">
                    <div style="display: flex; align-items: start; gap: 1rem;">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="#ef4444" style="flex-shrink: 0;">
                            <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                        </svg>
                        <div>
                            <div style="font-weight: 700; color: #ef4444; margin-bottom: 0.25rem;">Attendance Warning</div>
                            <span style="font-size: 0.875rem; color: #dc2626;">Your attendance is below the required 75%. Please improve your attendance to avoid academic penalties and ensure you don't fall behind in your studies.</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity & Performance Insights - Full Width Cards -->
            <div class="main-card" style="padding: 1.5rem; margin-bottom: 1.5rem; display: flex; flex-direction: column;">
                <h3 style="margin: 0 0 1.25rem 0; font-size: 1.125rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; padding-bottom: 0.75rem; border-bottom: 2px solid rgba(102, 126, 234, 0.2);">
                    <svg viewBox="0 0 24 24" width="22" height="22" fill="#667eea">
                        <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
                    </svg>
                    Recent Activity
                    <span style="margin-left: auto; font-size: 0.75rem; font-weight: 500; opacity: 0.6;">Last 5 Records</span>
                </h3>
                <div id="recentActivityFeed" style="display: flex; flex-direction: column; gap: 0.75rem; flex: 1; min-height: 150px; overflow-y: auto;">
                    <div style="text-align: center; padding: 3rem 1rem; opacity: 0.5; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                        <svg viewBox="0 0 24 24" width="56" height="56" fill="currentColor" style="opacity: 0.2;">
                            <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <p style="margin: 0.75rem 0 0 0; font-size: 0.875rem;">No recent activity</p>
                    </div>
                </div>
            </div>
            
            <div class="main-card" style="padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 1.25rem 0; font-size: 1.125rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; padding-bottom: 0.75rem; border-bottom: 2px solid rgba(102, 126, 234, 0.2);">
                    <svg viewBox="0 0 24 24" width="22" height="22" fill="#667eea">
                        <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                    </svg>
                    Performance Insights
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="padding: 1.25rem; background: rgba(102, 126, 234, 0.05); border-radius: 10px; border-left: 4px solid #667eea; min-height: 100px; display: flex; flex-direction: column; justify-content: space-between;">
                        <div style="font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">This Month</div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <span style="font-size: 0.8rem; opacity: 0.7;">Attendance Rate</span>
                            <span id="monthlyRate" style="font-size: 1.75rem; font-weight: 700; color: #667eea;">0%</span>
                        </div>
                    </div>
                    <div style="padding: 1.25rem; background: rgba(16, 185, 129, 0.05); border-radius: 10px; border-left: 4px solid #10b981; min-height: 100px; display: flex; flex-direction: column; justify-content: space-between;">
                        <div style="font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Present Streak</div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <span style="font-size: 0.8rem; opacity: 0.7;">Consecutive Days</span>
                            <span id="presentStreak" style="font-size: 1.75rem; font-weight: 700; color: #10b981;">0</span>
                        </div>
                    </div>
                    <div style="padding: 1.25rem; background: rgba(245, 158, 11, 0.05); border-radius: 10px; border-left: 4px solid #f59e0b; min-height: 100px; display: flex; flex-direction: column; justify-content: space-between;">
                        <div style="font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Classes to 75%</div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <span style="font-size: 0.8rem; opacity: 0.7;">Remaining to Goal</span>
                            <span id="classesNeeded" style="font-size: 1.75rem; font-weight: 700; color: #f59e0b;">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-card">
                                        <section class="attendance-index">
                                            <h2 class="attendance-title">Class Schedule</h2>
                                            <table class="attendance-schedule-table">
                                                <thead>
                                                    <tr>
                                                        <th>Subject</th>
                                                        <th>Day</th>
                                                        <th>Time</th>
                                                        <th>Teacher</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="classScheduleBody">
                                                    <tr>
                                                        <td colspan="4" style="text-align:center; padding:2rem;">
                                                            <span>Loading schedule...</span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </section>
                                        <section class="attendance-history-section">
                                            <div class="attendance-history-header">
                                                <h2 class="attendance-title">Attendance History</h2>
                                                <form class="attendance-search-form" autocomplete="off">
                                                    <input type="text" class="attendance-search-input" placeholder="Search date (YYYY-MM-DD)">
                                                    <select class="attendance-year-select">
                                                        <option value="2023">2023</option>
                                                        <option value="2022">2022</option>
                                                        <option value="2021">2021</option>
                                                    </select>
                                                    <button type="submit" class="attendance-search-btn">Search</button>
                                                </form>
                                            </div>
                                            <div class="table-responsive-wrapper" style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
                                            <table class="attendance-history-table">
                                                <thead>
                                                    <tr>
                                                        <th>Date</th>
                                                        <th>Time In</th>
                                                        <th>Time Out</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="attendanceTableBody">
                                                    <tr>
                                                        <td colspan="4" style="padding: 0; border: none;">
                                                            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 200px; padding: 3rem 1rem;">
                                                                <svg viewBox="0 0 24 24" width="56" height="56" fill="currentColor" style="opacity: 0.2; margin-bottom: 1rem;">
                                                                    <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                                                                </svg>
                                                                <h3 style="margin: 0; font-size: 1.1rem; font-weight: 600; opacity: 0.7;">No Data Yet</h3>
                                                                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; opacity: 0.5; text-align: center;">Your attendance records will appear here</p>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            </div>
                                        </section>
                            </div>
        </main>
    </div>
    <!-- Defensive theme toggle sync: ensure switch works and icons update -->
    <script>
        // Define logout function immediately to ensure it's always available
        window.doLogout = function() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear ALL session data
                sessionStorage.clear();
                
                // Set logout flag to prevent auto-login on back button
                sessionStorage.setItem('justLoggedOut', 'true');
                
                // Redirect to login page
                window.location.href = 'login.html';
            }
        };
        
        (function(){
            // Settings dropdown behavior
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsMenu = document.getElementById('settingsMenu');
            if (settingsToggle && settingsMenu) {
                settingsToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const open = settingsMenu.style.display === 'block';
                    settingsMenu.style.display = open ? 'none' : 'block';
                });
                document.addEventListener('click', (ev) => {
                    if (!settingsMenu.contains(ev.target) && ev.target !== settingsToggle) {
                        settingsMenu.style.display = 'none';
                    }
                });
            }

            function setTheme(next){
                document.documentElement.setAttribute('data-theme', next);
                try { localStorage.setItem('theme', next); } catch (e) {}
                applyIconsAndSwitch();
            }

            if (input) {
                input.addEventListener('change', () => {
                    const next = input.checked ? 'dark' : 'light';
                    setTheme(next);
                });
                // clicking wrapper toggles the checkbox (label already does this for input), but keep wrapper clickable
                wrapper.addEventListener('click', (e) => {
                    if (e.target === input) return; // input change handles it
                    input.checked = !input.checked;
                    input.dispatchEvent(new Event('change', { bubbles: true }));
                });
            } else {
                wrapper.addEventListener('click', () => {
                    const current = document.documentElement.getAttribute('data-theme');
                    const next = current === 'dark' ? 'light' : 'dark';
                    setTheme(next);
                });
            }

            // Observe theme attribute changes to update icons/switch
            const obs = new MutationObserver(() => applyIconsAndSwitch());
            obs.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });
        })();

        // Password Change Prompt Modal
        (function() {
            // Check if we should show the password prompt
            // Only show if: session flag is set AND localStorage doesn't have password changed flag
            const shouldShowPrompt = sessionStorage.getItem('showPasswordPrompt') === 'true';
            const passwordAlreadyChanged = localStorage.getItem('passwordChanged') === 'true';
            
            if (shouldShowPrompt && !passwordAlreadyChanged) {
                // Create modal
                const modal = document.createElement('div');
                modal.id = 'passwordPromptModal';
                modal.style.cssText = 'display:flex; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:9999; align-items:center; justify-content:center;';
                modal.innerHTML = `
                    <div style="background:var(--card-bg); padding:2rem; border-radius:16px; max-width:500px; width:90%; box-shadow:0 20px 50px rgba(0,0,0,0.3);">
                        <h2 style="color:var(--text-primary); margin-bottom:1rem; font-size:1.5rem;">Welcome! Please Change Your Password</h2>
                        <p style="color:var(--text-secondary); margin-bottom:1.5rem; line-height:1.6;">
                            For your security, we recommend changing your password. 
                            Please go to Settings to update your password.
                        </p>
                        <div style="display:flex; gap:1rem; justify-content:flex-end; flex-wrap:wrap;">
                            <button id="remindLaterBtn" style="background:#94a3b8; color:white; padding:0.75rem 1.5rem; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:all 0.2s;" onmouseover="this.style.background='#64748b'" onmouseout="this.style.background='#94a3b8'">
                                Remind Me Later
                            </button>
                            <button id="goToSettingsBtn" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; padding:0.75rem 1.5rem; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                Go to Settings
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Handle buttons
                document.getElementById('remindLaterBtn').addEventListener('click', () => {
                    sessionStorage.removeItem('showPasswordPrompt');
                    modal.remove();
                });

                document.getElementById('goToSettingsBtn').addEventListener('click', () => {
                    sessionStorage.removeItem('showPasswordPrompt');
                    window.location.href = 'settings.html';
                });
            } else {
                // Clear the prompt flag if password was already changed
                sessionStorage.removeItem('showPasswordPrompt');
            }
        })();
    </script>

    <!-- Notifications Modal -->
    <div id="notificationsModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.6); z-index:10000; align-items:center; justify-content:center; padding:1rem;">
        <div style="background:var(--card-bg); border-radius:16px; width:90%; max-width:650px; max-height:85vh; overflow:hidden; display:flex; flex-direction:column; box-shadow:0 20px 60px rgba(0,0,0,0.3); position:relative; pointer-events:auto;">
            <div style="padding:1.5rem 2rem; border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between; align-items:center; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h2 style="margin:0; font-size:1.5rem; color:white; font-weight:700;">ðŸ“¢ Notifications</h2>
                <button id="closeNotificationsBtn" style="background:rgba(255,255,255,0.2); border:none; cursor:pointer; font-size:1.5rem; color:white; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">&times;</button>
            </div>
            <div id="notificationsList" style="flex:1; overflow-y:auto; padding:1.5rem; min-height:200px;">
                <div style="text-align:center; padding:3rem; color:var(--text-secondary);">
                    <div style="font-size:3rem; margin-bottom:1rem;">ðŸ“­</div>
                    <span>Loading notifications...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Dashboard Script -->
    <script type="module" src="js/student-dashboard.js"></script>
</body>
</html>
